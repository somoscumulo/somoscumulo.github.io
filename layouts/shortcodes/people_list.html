<!-- layouts/shortcodes/people_list.html -->
{{/* 
  Uso: {{< people_list group="equipo" columns=6 gapx="6rem" gapy="2.5rem" >}}
  Requiere en cada author (content/authors/<slug>/_index.md):
    user_groups: ["equipo"] o ["colaboran"], etc.
*/}}

{{- $groupRaw := .Get "group"   | default "equipo" -}}
{{- $group    := lower $groupRaw -}}
{{- $columns  := .Get "columns" | default 6 -}}
{{- $gapx     := .Get "gapx"    | default "6rem" -}}
{{- $gapy     := .Get "gapy"    | default "2.5rem" -}}

{{/* Tomar la sección authors de forma robusta (branch bundles) */}}
{{- $sec := site.GetPage "section" "authors" -}}
{{- if not $sec -}}
  {{- $sec = site.GetPage "/authors" -}}
{{- end -}}

{{/* Colección combinada: branch (.Pages) + leaf (.RegularPages) + fallback global */}}
{{- $candidates := slice -}}
{{- if $sec -}}
  {{- $candidates = $candidates | append $sec.Pages -}}
  {{- $candidates = $candidates | append $sec.RegularPages -}}
{{- end -}}
{{- if eq (len $candidates) 0 -}}
  {{- $candidates = where site.RegularPages "Section" "authors" -}}
{{- end -}}

<div style="display:grid;grid-template-columns:repeat({{ $columns }},minmax(0,1fr));column-gap:{{ $gapx }};row-gap:{{ $gapy }};justify-items:center;align-items:start;">
  {{- range $p := $candidates -}}
    {{- $groups := $p.Params.user_groups | default (slice) -}}
    {{- $has := false -}}
    {{- range $g := $groups -}}
      {{- if eq (lower (printf "%v" $g)) $group -}}
        {{- $has = true -}}
      {{- end -}}
    {{- end -}}
    {{- if $has -}}
      {{- $slug := (path.Base (strings.TrimSuffix "/" $p.File.Dir)) -}}
      {{- $avatar := $p.Resources.GetMatch "avatar*" -}}
      {{- $avatarURL := "" -}}
      {{- if $avatar -}}
        {{- $avatarURL = $avatar.RelPermalink -}}
      {{- else -}}
        {{- $avatarURL = printf "/authors/%s/avatar.jpg" $slug -}}
      {{- end -}}

      <a href="{{ $p.RelPermalink }}" style="text-align:center;text-decoration:none;display:block;">
        <div style="width:9.5rem;height:9.5rem;border-radius:9999px;overflow:hidden;margin:0 auto;box-shadow:0 1px 4px rgba(0,0,0,.08);display:flex;align-items:center;justify-content:center;">
          <img src="{{ $avatarURL }}" alt="{{ $p.Title }}" style="width:100%;height:100%;object-fit:cover;object-position:center;display:block;">
        </div>
        <div style="margin-top:.5rem;font-weight:600;color:inherit;">{{ $p.Title }}</div>
      </a>
    {{- end -}}
  {{- end -}}
</div>
