{{ define "main" }}
<article class="container mx-auto max-w-3xl px-6 md:px-10 xl:px-12 py-8 text-gray-900 dark:text-white">

  {{/* Avatar como Page Resource si es bundle; fallback a /authors/<slug>/avatar.jpg */}}
  {{ $avatar := cond (ne .File nil) (.Resources.GetMatch "avatar*") nil }}
  {{ $authorKey := "" }}
  {{ if .File }}
    {{ $authorKey = ( .File.Dir | strings.TrimSuffix "/" | path.Base ) }}
  {{ else }}
    {{ $authorKey = ( .RelPermalink | strings.TrimSuffix "/" | path.Base ) }}
  {{ end }}

  <header class="mb-8 text-center">
    <div class="mx-auto rounded-full overflow-hidden w-40 h-40 md:w-48 md:h-48 shadow">
      {{ if $avatar }}
        <img src="{{ $avatar.RelPermalink }}" alt="{{ .Title }}" class="w-full h-full object-cover" loading="lazy">
      {{ else }}
        <img src="{{ printf "/authors/%s/avatar.jpg" $authorKey }}" alt="{{ .Title }}" class="w-full h-full object-cover" loading="lazy">
      {{ end }}
    </div>

    <h1 class="mt-4 text-3xl font-extrabold tracking-tight">{{ .Title }}</h1>
    {{ with .Params.role }}<p class="opacity-80 mt-1">{{ . }}</p>{{ end }}
    {{ with .Params.email }}
      <p class="mt-2"><a href="mailto:{{ . }}" class="underline hover:no-underline">{{ . }}</a></p>
    {{ end }}
  </header>

  <div class="prose dark:prose-invert max-w-none">
    {{ .Content }}
  </div>

  {{/* Posts del autor (opcional) */}}
  {{ $keys := slice (lower $authorKey) (lower .Title) (lower (default "" .Params.name)) }}
  {{ $posts := slice }}
  {{ range where .Site.RegularPages "Type" "post" }}
    {{ $auth := .Params.authors }}
    {{ if $auth }}
      {{ $hit := false }}
      {{ $t := printf "%T" $auth }}
      {{ if eq $t "[]interface {}" }}
        {{ range $auth }}
          {{ $a := "" }}
          {{ if (eq (printf "%T" .) "map[string]interface {}") }}
            {{ if isset . "name" }}{{ $a = lower (printf "%v" (index . "name")) }}{{ end }}
            {{ if and (eq $a "") (isset . "title") }}{{ $a = lower (printf "%v" (index . "title")) }}{{ end }}
          {{ else }}
            {{ $a = lower (printf "%v" .) }}
          {{ end }}
          {{ if in $keys $a }}{{ $hit = true }}{{ end }}
        {{ end }}
      {{ else if eq $t "string" }}
        {{ if in $keys (lower $auth) }}{{ $hit = true }}{{ end }}
      {{ end }}
      {{ if $hit }}{{ $posts = $posts | append . }}{{ end }}
    {{ end }}
  {{ end }}
  {{ $posts = sort $posts "Date" "desc" }}

  {{ if gt (len $posts) 0 }}
    <section class="mt-10">
      <h2 class="text-lg font-semibold mb-3">Publicaciones</h2>
      <ul class="list-disc list-inside space-y-1">
        {{ range $posts }}
          <li><a href="{{ .RelPermalink }}" class="underline hover:no-underline">{{ .Title }}</a></li>
        {{ end }}
      </ul>
    </section>
  {{ end }}

</article>
{{ end }}
